+++
title = "GSoC 2025 Chromium"
date = "2025-09-13"
description = "Blog showcasing work done through the Google Summer of Code 2025 @ Chromium by Hamed Elgizery"
url = "blog/gsoc-2025-chromium"
+++

### Introduction
During the summer of 2025, I contributed to the Chromium organization
as part of my participation in Google Summer of Code (GSoC).
More specifically, I was on the ChromiumOS side, where I worked on
supporting Google's Hammer detachable keyboard.
In particular, I focused on integrating its firmware update mechanisms
into FWUPD, as part of Google's shift towards supporting open source
and relying on an open-source unified device firmware updater for
Google's devices.

### Project Description

The project’s main target is to support firmware updates using a
fwupd plugin to manage and handle firmware updates for the Hammer
detachable keyboard. Normally, the firmware updates are handled using
[hammerd](https://chromium.googlesource.com/chromiumos/platform2/+/HEAD/hammerd/README.md),
a hammer firmware updater daemon.

#### Why the miagration to fwupd? 

This is part of a longer term goal, that is to be able to completely / partially migrate to fwupd for firmware updates, not only for Hammer, but for other devices as well. This step has several reasons, listing a few:
- Utility Compatibility: some vendors ship only Windows compatible utilities, which is problematic given the ChromiumOS Linux core.
- Scalability: as the number of hardware devices increases, and the different designs they are released with, the number of utility duplications increases, causing unnecessary overhead on the root file system space, in addition to more maintenance overhead.
- Maintenance: in many cases, vendors ship utilities that are built only for ChromeOS, and then they are rarely updated.


### Project Outcomes 

First, let’s mention what the structure of the hammer device is,
quoting from the ChromiumOS docs:

> hammer is the base of detachable, connected via USB over pogo pins.
> hammer runs its own upgradable firmware (base EC, running EC codebase
> on STM32F072), is attached to a touchpad (with its own upgradable FW),
> and is able to pair with the detachable.

During this project, I added the foundations for supporting Hammer
updates to a pre-existing fwupd plugin, namely
[cros-ec](https://github.com/fwupd/fwupd/tree/main/plugins/cros-ec).
The commonality between Hammer and plugin is that Hammer, within its core, is an EC with the addition of a touchpad connected over an I2C bus.
There, the plan was to start migrating the plugin update flow according
to Hammer's needs, while maintaining backward compatibility for other
devices. Having a starting ground, we had two iterations of different
implementation designs. During the first iteration, I inserted extra
pieces of code within the usual update flow to be executed in case the
update was intended for Hammer. The primary concern here is that things
could easily get messed up if not careful, so moving on to the second
iteration. I reimplemented the same flow that was used for the EC,
but by subclassing the ``FuCrosEcUsbDevice`` into ``FuCrosEcUsbHammer``.
We agreed that this implementation is safer, as it maintains backward
compatibility and separates the logic for Hammer from other EC devices,
which would be more scalable when adding other features provided by Hammerd.

### Fwupd PRs:
- [trivial: allow multiple DEVICE-ID to get-updates command](https://github.com/fwupd/fwupd/pull/8837) 
- [Incorporate ANOTHER\_WRITE\_REQUIRED flag within fu\_device\_list\_replace](https://github.com/fwupd/fwupd/pull/9068)
- [Preparing the ec-cros plugin for subclassing](https://github.com/HamedElgizery/fwupd/pull/3)
- [cros-ec: Prepare plugin for further subclassing](https://github.com/fwupd/fwupd/pull/9289)
- [Add unit test for Hammer](https://github.com/HamedElgizery/fwupd/pull/4): 
- ~~[Add hammer ec/touchpad support](https://github.com/HamedElgizery/fwupd/pull/2)~~: adds support for Hammer EC & Touchpad by adding extra feature to the pre-existing flow. Later scraped off to subclass the CrosEcUsbDevice further and override as needed, maintaining backwared compatibility.

### ChromiumOS CLs:
- [touch\_updater: Update touch firmware report docs report\_updater\_version](https://chromium-review.googlesource.com/c/chromiumos/platform/touch_updater/+/6580172)
- [touch\_updater: Add report\_tool\_version to chromeos-touch-common.sh](https://chromium-review.googlesource.com/c/chromiumos/platform/touch_updater/+/6375383)
- [Fix typo in platform/firmware README.md file](https://chromium-review.googlesource.com/c/chromiumos/platform/firmware/+/6438831)

### Chromium CL:
- [[PWA] Add web\_app\_database\_serialization.h/cc](https://chromium-review.googlesource.com/c/chromium/src/+/6304941):


### Future Work?
There is always more to be done. Currently, the foundation for supporting
Hammer is being established, which will enable firmware updates for the USB Hammer device.
But there are also the I2C Hammer devices that can be supported in the future.
Now I am working with my mentors to ship Fwupd Hammer support soon.
Still, after gaining sufficient confidence in all the details of the plugin.
The next step will be to utilize it within ChromiumOS, setting it up so that
it runs as part of the on-boot jobs to ensure Hammer is up to date,
currently not supported unless the files are installed manually and flashed,
which is inconvenient for end-users. On the other hand,
fwupd will be able to check for updates released on LVFS and install
them automatically as needed.
A similar flow is already being used within ChromiumOS to manage SSD
firmware updates with Fwupd, and can be referenced for inspiration on how
to implement a similar mechanism.

### Experience & Acquired Skills
It has been quite a summer. First, working on low-level projects wasn’t
something that I had much experience in, so it was a fruitful stretch of my
comfort zone. I have learned about how the Kernel interacts with devices
and explored some of the firmware formats, such as the FMAP format.
I had to learn a lot about fwupd on the go, going through a large codebase
and exploring/patching the core of Fwupd to fulfill the plugin needs.
Got to learn GLib & GObject, which Fwupd heavily relies on,
psst these are pretty cool :) I got to work on a real physical device.
Additionally, even before the GSoC began, I had learned a great deal from
reviewing the Chromium repository and making some relatively straightforward
contributions, which allowed me to become familiar with Proto files.
Overall, I have learned a lot, and for me, that is worth a great deal.

### Thanks Acknowledgements
I would like to thank my mentors, Henry Barnor and Jingyuan Liang, for their
continuous support and guidance throughout this project.
Their feedback and insights during our weekly sync-ups were invaluable in
keeping me on track. In addition, Jingyuan’s help with testing through
many iterations was instrumental in moving the work forward.
I deeply appreciate the time and effort they both dedicated to mentoring me.
